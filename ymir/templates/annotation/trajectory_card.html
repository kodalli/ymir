<div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
    <!-- Header -->
    <div class="flex justify-between items-start mb-4">
        <div>
            <h3 class="font-medium">{{ trajectory.scenario_description }}</h3>
            <p class="text-sm text-gray-400">ID: {{ trajectory.id[:12] }}...</p>
        </div>
        <div class="text-right">
            {% if trajectory.quality_score %}
            <div class="text-lg font-bold {% if trajectory.quality_score >= 0.7 %}text-green-500{% elif trajectory.quality_score >= 0.5 %}text-yellow-500{% else %}text-red-500{% endif %}">
                {{ "%.2f"|format(trajectory.quality_score) }}
            </div>
            <div class="text-xs text-gray-500">Quality Score</div>
            {% endif %}
        </div>
    </div>

    <!-- Issues -->
    {% if issues %}
    <div class="bg-yellow-900/30 border border-yellow-700 rounded-md p-3 mb-4">
        <div class="text-sm font-medium text-yellow-400 mb-2">Quality Issues:</div>
        <ul class="text-sm text-yellow-300 list-disc list-inside">
            {% for issue in issues %}
            <li>{{ issue }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Messages -->
    <div class="space-y-3 max-h-[400px] overflow-y-auto mb-4">
        {% for message in trajectory.messages %}
        <div class="{% if message.role.value == 'user' %}message-user{% elif message.role.value == 'assistant' %}message-assistant{% else %}message-tool{% endif %} p-3 rounded-md">
            <div class="text-xs text-gray-400 mb-1 uppercase">{{ message.role.value }}</div>
            <div class="whitespace-pre-wrap text-sm">{{ message.content[:500] }}{% if message.content|length > 500 %}...{% endif %}</div>
        </div>
        {% endfor %}
    </div>

    <!-- Review Form -->
    <form hx-post="/annotation/review/{{ trajectory.id }}" hx-target="#review-container" hx-swap="innerHTML">
        <div class="flex items-center space-x-3">
            <input type="text" name="notes" placeholder="Notes (optional)"
                class="flex-1 bg-gray-700 border border-gray-600 rounded-md p-2 text-white text-sm">

            <button type="submit" name="status" value="approved"
                class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md">
                Approve
            </button>
            <button type="submit" name="status" value="rejected"
                class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-md">
                Reject
            </button>
            <button type="submit" name="status" value="needs_edit"
                class="bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 px-4 rounded-md">
                Needs Edit
            </button>
        </div>
    </form>
</div>
