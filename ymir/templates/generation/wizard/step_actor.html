<!-- Step 3: Configure Actor -->
<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-start gap-4">
        <div class="flex-shrink-0">
            <span class="inline-flex items-center justify-center w-8 h-8 rounded-lg bg-ymir-500/10 text-ymir-500 font-semibold">
                3
            </span>
        </div>
        <div class="flex-1">
            <h2 class="text-2xl font-bold text-white mb-2">Configure the Actor</h2>
            <p class="text-slate-400">Define who will interact with the agent during the trajectory</p>
        </div>
    </div>

    <!-- Info Box -->
    <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-4 space-y-2">
        <div class="flex items-start gap-3">
            <i data-lucide="info" class="w-5 h-5 text-ymir-500 flex-shrink-0 mt-0.5"></i>
            <div class="text-sm text-slate-300 space-y-1">
                <p><strong class="text-white">ACTOR:</strong> The simulated user who will interact with the agent.</p>
                <p>In a medical scenario, this might be a patient calling to schedule an appointment.</p>
                <p>Choose how you want to provide input to the agent.</p>
            </div>
        </div>
    </div>

    <!-- Mode Selection -->
    <div class="space-y-4">
        <label class="block text-sm font-medium text-slate-300">Input Mode</label>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Single Query Mode -->
            <label class="relative flex cursor-pointer">
                <input
                    type="radio"
                    name="mode_toggle"
                    value="single"
                    checked
                    class="peer sr-only"
                    _="on change
                       if my.checked
                         show #single-fields
                         hide #simulated-fields
                       end"
                >
                <div class="flex-1 border-2 border-slate-700 rounded-lg p-6 transition-all
                            peer-checked:border-ymir-500 peer-checked:bg-ymir-500/5
                            hover:border-slate-600 hover:bg-slate-800/50">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 p-2 rounded-lg bg-slate-800">
                            <i data-lucide="message-square" class="w-6 h-6 text-ymir-500"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-white mb-1">Single Query</h3>
                            <p class="text-sm text-slate-400">Provide one query. The agent will use tools to complete the task.</p>
                        </div>
                    </div>
                </div>
            </label>

            <!-- Simulated Actor Mode -->
            <label class="relative flex cursor-pointer">
                <input
                    type="radio"
                    name="mode_toggle"
                    value="simulated"
                    class="peer sr-only"
                    _="on change
                       if my.checked
                         hide #single-fields
                         show #simulated-fields
                       end"
                >
                <div class="flex-1 border-2 border-slate-700 rounded-lg p-6 transition-all
                            peer-checked:border-ymir-500 peer-checked:bg-ymir-500/5
                            hover:border-slate-600 hover:bg-slate-800/50">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 p-2 rounded-lg bg-slate-800">
                            <i data-lucide="users" class="w-6 h-6 text-ymir-500"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-white mb-1">Simulated Actor</h3>
                            <p class="text-sm text-slate-400">AI simulates a person with a background and goal, having a natural conversation.</p>
                        </div>
                    </div>
                </div>
            </label>
        </div>
    </div>

    <!-- Single Query Fields -->
    <div id="single-fields" class="space-y-4">
        <div>
            <label for="query-input" class="block text-sm font-medium text-slate-300 mb-2">
                User Query
            </label>
            <textarea
                id="query-input"
                name="user_query_input"
                rows="4"
                class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg
                       text-white placeholder-slate-500 focus:outline-none focus:ring-2
                       focus:ring-ymir-500 focus:border-transparent resize-none"
                placeholder="Enter the query the user will ask the agent..."
            ></textarea>
        </div>

        {% if scenario.example_queries and scenario.example_queries|length > 0 %}
        <div>
            <label class="block text-sm font-medium text-slate-300 mb-2">
                Example Queries
            </label>
            <div class="flex flex-wrap gap-2">
                {% for query in scenario.example_queries %}
                <button
                    type="button"
                    class="px-3 py-2 text-sm bg-slate-800 hover:bg-slate-700 text-slate-300
                           rounded-lg border border-slate-700 hover:border-slate-600 transition-colors"
                    _="on click set #query-input.value to '{{ query|replace("'", "\\'") }}'"
                >
                    {{ query }}
                </button>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Simulated Actor Fields -->
    <div id="simulated-fields" class="space-y-6 hidden">
        <div>
            <label class="block text-sm font-medium text-slate-300 mb-3">
                Choose a Persona
            </label>

            <!-- Persona Preset Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                {% for persona in personas %}
                <div
                    class="persona-card cursor-pointer border-2 border-slate-700 rounded-lg p-4
                           transition-all hover:border-slate-600 hover:bg-slate-800/50"
                    data-persona-id="{{ persona.id }}"
                    data-background="{{ persona.background|replace('"', '&quot;') }}"
                    data-goal="{{ persona.goal|replace('"', '&quot;') }}"
                    _="on click
                         remove .border-ymir-500 from .persona-card
                         remove .bg-ymir-500/5 from .persona-card
                         add .border-ymir-500 to me
                         add .bg-ymir-500/5 to me
                         set #persona-background.value to my @data-background
                         set #persona-goal.value to my @data-goal
                         show #persona-form"
                >
                    <div class="flex items-start gap-3 mb-3">
                        <div class="flex-shrink-0 p-2 rounded-lg bg-slate-800">
                            <i data-lucide="{{ persona.icon }}" class="w-5 h-5 text-ymir-500"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-semibold text-white mb-1">{{ persona.name }}</h4>
                            <p class="text-sm text-slate-400 line-clamp-2">
                                {{ persona.background[:100] }}{% if persona.background|length > 100 %}...{% endif %}
                            </p>
                        </div>
                    </div>

                    {% if persona.tags and persona.tags|length > 0 %}
                    <div class="flex flex-wrap gap-1.5">
                        {% for tag in persona.tags %}
                        <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium
                                     bg-slate-800 text-slate-400 rounded">
                            {{ tag }}
                        </span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}

                <!-- Custom Persona Card -->
                <div
                    class="persona-card cursor-pointer border-2 border-slate-700 rounded-lg p-4
                           transition-all hover:border-slate-600 hover:bg-slate-800/50"
                    data-persona-id="custom"
                    data-background=""
                    data-goal=""
                    _="on click
                         remove .border-ymir-500 from .persona-card
                         remove .bg-ymir-500/5 from .persona-card
                         add .border-ymir-500 to me
                         add .bg-ymir-500/5 to me
                         set #persona-background.value to ''
                         set #persona-goal.value to ''
                         show #persona-form"
                >
                    <div class="flex items-start gap-3 mb-3">
                        <div class="flex-shrink-0 p-2 rounded-lg bg-slate-800">
                            <i data-lucide="pencil" class="w-5 h-5 text-ymir-500"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-white mb-1">Custom</h4>
                            <p class="text-sm text-slate-400">Create your own persona from scratch</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Persona Form (shown when a persona is selected) -->
            <div id="persona-form" class="space-y-4 hidden">
                <div>
                    <label for="persona-background" class="block text-sm font-medium text-slate-300 mb-2">
                        Background
                        <span class="text-slate-500 font-normal">Describe who this person is</span>
                    </label>
                    <textarea
                        id="persona-background"
                        name="user_background_input"
                        rows="4"
                        class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg
                               text-white placeholder-slate-500 focus:outline-none focus:ring-2
                               focus:ring-ymir-500 focus:border-transparent resize-none"
                        placeholder="E.g., A 65-year-old patient with diabetes who needs to schedule a follow-up appointment..."
                    ></textarea>
                </div>

                <div>
                    <label for="persona-goal" class="block text-sm font-medium text-slate-300 mb-2">
                        Goal
                        <span class="text-slate-500 font-normal">What does this person want to accomplish?</span>
                    </label>
                    <textarea
                        id="persona-goal"
                        name="user_goal_input"
                        rows="3"
                        class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg
                               text-white placeholder-slate-500 focus:outline-none focus:ring-2
                               focus:ring-ymir-500 focus:border-transparent resize-none"
                        placeholder="E.g., Schedule an appointment with Dr. Smith next week and get a prescription refilled..."
                    ></textarea>
                </div>
            </div>
        </div>
    </div>
</div>
