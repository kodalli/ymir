<div class="space-y-6">
    {% if saved %}
    <div class="flex items-center gap-3 bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 px-4 py-3 rounded-xl animate-in fade-in slide-in-from-top-2">
        <i data-lucide="check-circle-2" class="w-5 h-5"></i>
        <div class="text-sm">
            <span class="font-bold">Trajectory saved successfully!</span>
            <span class="opacity-70 ml-1">ID: {{ trajectory.id[:12] }}</span>
        </div>
    </div>
    {% endif %}

    <div class="flex items-center gap-4 text-xs font-bold text-slate-500 uppercase tracking-widest pb-4 border-b border-slate-700/50">
        <div class="flex items-center gap-1.5">
            <i data-lucide="repeat" class="w-3.5 h-3.5"></i>
            {{ trajectory.turn_count() }} Turns
        </div>
        <div class="flex items-center gap-1.5">
            <i data-lucide="wrench" class="w-3.5 h-3.5"></i>
            {{ trajectory.tool_call_count() }} Tool Calls
        </div>
        {% if trajectory.quality_score %}
        <div class="flex items-center gap-1.5 px-2 py-0.5 bg-ymir-500/10 text-ymir-500 rounded">
            <i data-lucide="award" class="w-3.5 h-3.5"></i>
            Score: {{ "%.2f"|format(trajectory.quality_score) }}
        </div>
        {% endif %}
    </div>

    <div class="space-y-4">
        {% for message in trajectory.messages %}
        <div class="flex flex-col {% if message.role.value == 'user' %}items-start{% elif message.role.value == 'assistant' %}items-end{% else %}items-center{% endif %}">
            <div class="flex items-center gap-2 mb-1 px-1">
                <span class="text-[10px] font-black uppercase tracking-widest text-slate-500">
                    {{ message.role.value }}
                </span>
            </div>
            
            <div class="max-w-[90%] p-3 rounded-xl text-sm leading-relaxed overflow-x-auto custom-scrollbar {% if message.role.value == 'user' %}bg-slate-800 border border-slate-700 text-slate-200 rounded-tl-none{% elif message.role.value == 'assistant' %}bg-ymir-500 text-white rounded-tr-none{% else %}bg-slate-900 border border-slate-800 text-slate-500 font-mono text-xs rounded-lg italic{% endif %}">
                <div class="whitespace-pre-wrap break-words">{{ message.content }}</div>
                
                {% if message.tool_calls %}
                <div class="mt-2 pt-2 border-t border-white/10 space-y-1">
                    {% for tool_call in message.tool_calls %}
                    <div class="flex items-center gap-2 bg-black/10 p-1.5 rounded text-[10px] font-mono">
                        <i data-lucide="terminal" class="w-3 h-3 text-white/50"></i>
                        <span class="text-white/80">{{ tool_call.function.name }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="pt-6 flex justify-center gap-3">
        <button class="btn-secondary text-sm flex items-center gap-2 px-6" hx-get="/generation" hx-target="#main-content" hx-swap="innerHTML">
            <i data-lucide="plus" class="w-4 h-4"></i>
            New Trajectory
        </button>
        <button class="btn-primary text-sm flex items-center gap-2 px-6" hx-get="/annotation" hx-target="#main-content" hx-swap="innerHTML">
            <i data-lucide="clipboard-check" class="w-4 h-4"></i>
            Go to Review
        </button>
    </div>
</div>
